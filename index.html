<!-- HTML é–‹é ­ç•¥é (doctype, head, style ç›¸åŒ) -->
<body>
  <div id="map"></div>
  <div id="version">ç‰ˆæœ¬ 2.0.8</div>
  <div id="zoomDisplay">Zoom: -</div>

  <!-- å›ºå®šè³‡è¨Šé¢æ¿ -->
  <div id="infoPanel" style="
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    padding: 10px;
    max-width: 250px;
    font-size: 16px;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
  ">
    <b>æ¨™è¨˜è³‡è¨Š</b><br>
    <div id="infoContent">é»æ“Šæ¨™è¨˜ä»¥æŸ¥çœ‹è³‡è¨Š</div>
  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // ...ï¼ˆä¿æŒåŸæœ¬ JavaScript ä¸è®Šï¼Œä»¥ä¸‹åªåˆ—å‡ºæ”¹å‹•å€ï¼‰

    class MapApp {
      constructor() {
        // åŸæœ¬ constructor å…§å®¹ä¿æŒä¸è®Š...
        this.infoContent = document.getElementById('infoContent');
      }

      // æ›´æ–° getPopupContent ç‚ºæ›´æ–° infoPanel
      getPopupContent(marker, data) {
        // ä¸å†ä½¿ç”¨ popup å…§å®¹ï¼Œé€™è£¡åªå›å‚³æ–‡å­—
        return `
          <b>${data.name}</b><br>
          æ™‚é–“: ${data.time}<br>
          é¡å‹: ${markerColors[data.type] || 'åŸå§‹'}<br>
          å‚™è¨»: ${data.remark}<br>
          ${this.editMode ? `<button onclick="app.deleteMarker('${marker._leaflet_id}')">ğŸ—‘ï¸ åˆªé™¤æ¨™è¨˜</button>` : ''}
        `;
      }

      showInfoInPanel(marker) {
        const data = marker.data;
        const html = `
          <b>${data.name}</b><br>
          æ™‚é–“: ${data.time}<br>
          é¡å‹: ${markerColors[data.type] || 'åŸå§‹'}<br>
          å‚™è¨»: ${data.remark}<br>
          ${this.editMode ? `<button onclick="app.deleteMarker('${marker._leaflet_id}')">ğŸ—‘ï¸ åˆªé™¤æ¨™è¨˜</button>` : ''}
        `;
        this.infoContent.innerHTML = html;
      }

      addMarker(latlng, data) {
        const marker = L.marker(latlng, {
          draggable: this.editMode,
          icon: this.getCustomIcon(data.type)
        });

        marker.data = data;
        // marker.bindPopup(this.getPopupContent(marker, data)); // ç§»é™¤ popup ç¶å®š
        marker.on('dragend', () => this.saveMarkers());
        marker.on('click', () => {
          if (this.editMode) {
            this.cycleMarkerColor(marker);
          } else if (this.routeSelecting) {
            if (this.selectedMarkers.includes(marker)) {
              this.selectedMarkers = this.selectedMarkers.filter(m => m !== marker);
              marker.setOpacity(1);
            } else {
              this.selectedMarkers.push(marker);
              marker.setOpacity(0.5);
            }
          } else {
            this.showInfoInPanel(marker);
          }
        });

        this.markers.addLayer(marker);
        this.saveMarkers();
        this.filterMarkersByTypes();
        this.updateMarkerScales();
      }
    }

    const app = new MapApp();
  </script>
</body>
</html>
